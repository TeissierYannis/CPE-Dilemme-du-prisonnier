<h1 align="center">CPE Lyon - 3ICS - Ann√©e 2021/22
D√©veloppement informatique ‚Äì 2
Projet </h1>

<div align="center">

[![CTF](https://img.shields.io/badge/CPE_LYON-2021-blue.svg)](https://france-cybersecurity-challenge.fr/)
[![CTF](https://img.shields.io/badge/Language-C-yellow.svg)](#)
[![CTF](https://img.shields.io/badge/Category-Network/C-red.svg)](#)

</div>

--- 

## üìù Table des mati√®res

Consignes de l'√©preuve
- [Contexte](#context)
- [Fonctionnalit√©s du syst√®me](#features)
- [Serveur](#features_server)
- [Client](#features_client)
- [Architecture du syst√®me informatis√©](#archi)
- [Gestion des donn√©es](#data_monitoring)
- [Gestion des √©changes client/serveur](#communication)
- [Consignes](#consignes)
- [Travail de base demand√©](#consigne_base)
- [Support](#consigne_support)
- [√âvaluation du travail](#eval)
- [Soutenance](#eval_oral)
- [Rapport](#eval_rapport)

Travail effectu√©
- [L'√©quipe](#team)
- [R√©partition du travail](#work_distribution)
- [M√©thodologie](#methodology)
- [Justification des choix](#justify)
- [R√©gles de communication](#communications_rules)
- [Les difficult√©s](#difficulties)
- [Bilan](#bilan)

Fonctionnement
- [Build](#build)
- [Configuration Serveur](#config_server)
- [Configuration Client](#config_client)
- [Documentation](#doc)

## üßê Enonc√© <a name = "context"></a>

l‚ÄôICS (institue of Cognitives Sciences) est un laboratoire interdisciplinaire qui int√®gre l'expertise de
chercheurs des Sciences de la Vie (psychologie cognitive, neurosciences) et de m√©decine (p√©dopsychiatrie, neuro-pediatrie) avec celle de chercheurs des Sciences Humaines et Sociales
(linguistique computationelle et th√©orique et philosophie) pour √©tudier la nature et la sp√©cificit√© de
l'esprit humain.

L‚Äôun des doctorants travaille sur la th√©orie des jeux, √† la fronti√®re de la psychologie et des
math√©matiques, et notamment sur les jeux a somme non constante. Une des illustrations la plus
connue de ces jeux est le dilemme du prisonnier :
 - https://fr.wikipedia.org/wiki/Dilemme_du_prisonnier

Ces deux vid√©os devraient vous √©clairer sur la th√©orie des jeux :
 - https://www.youtube.com/watch?v=StRqGx9ri2I, notamment √† partir de 7‚Äô15‚Äô‚Äô.
 - https://www.youtube.com/watch?v=uijJJ2OczNs&t=913s

Le doctorant, qui n‚Äôest pas un d√©veloppeur, a besoin d‚Äôaccumuler des donn√©es exp√©rimentales. Il a
besoin que des volontaires jouent l‚Äôun contre l‚Äôautre un nombre de fois √† d√©finir, sans jamais savoir
qui sont leurs adversaires.

On d√©finira une partie comme √©tant un certain nombre de rounds. Un round est d√©fini comme une
confrontation trahison-collaboration entre les deux volontaires.

Le doctorant a travaill√© avec l‚Äôing√©nieur d‚Äô√©tudes du laboratoire pour d√©finir un cahier des charges.
L‚Äôing√©nieur d‚Äô√©tudes √† un planning tr√®s charg√©, mais il a amorc√© les projets (le code du serveur et le
code du client). Il a aussi pr√©vu quelques heures pour vous exposer l‚Äô√©tat des projets et le principe
de fonctionnement (gestion des sockets, gestion des connexions, communication asynchrone,
multit√¢che). Il vous pr√©sentera aussi les outils n√©cessaires pour d√©velopper une interface graphique
avec GTK pour l‚Äôapplication cliente.

Vous (le chef de projet) avez √©t√© contact√© pour mettre en place une √©quipe (2 dev + 2 r√©seaux) afin
de d√©velopper les deux applications le plus rapidement possible.


## üßê Fonctionnalit√©s du syst√®me <a name = "features"></a>

Le syst√®me informatique doit √™tre param√©trable par un non-informaticien et doit permettre d‚Äôobtenir
et conserver les r√©sultats des multiples exp√©rimentations.

Vous devez tenir compte du fait qu‚Äôil peut y avoir plusieurs parties simultan√©ment (deux
actuellement, √©tant tenu compte du mat√©riel dont dispose le laboratoire) et que prochainement le
laboratoire disposera encore de quelques ordinateurs suppl√©mentaires.

## üßê Serveur <a name = "features_server"></a>

Le serveur doit √™tre param√©trable. Le fichier de param√©trage permettra de d√©finir l‚Äôadresse IP et le
port sur lequel l‚Äôapplication serveur sera √† l‚Äô√©coute.

Le fichier contiendra aussi le param√©trage n√©cessaire pour d√©finir les r√©gl√©s du jeu : somme engag√©e
a chaque partie, le nombre de parties et d‚Äôautres informations qui vous sembleront n√©cessaires.

A la fin de la partie, le serveur doit garder dans un fichier (le format est √† d√©finir) les choix de
chacun des joueurs, ainsi que le temps de d√©cision et les montants accumul√©s ou perdus.

## üßê Client <a name = "features_client"></a>

Le fichier de param√©trage du client doit contenir l‚Äôadresse IP du serveur ainsi que le port et tout
autre param√©trage qui vous sembleront pertinents.

L‚Äôinterface graphique des clients doit rester tr√®s simple : le cobaye ne doit pas √™tre d√©concentr√© par
des fioritures :
- deux boutons cliquables (Trahir, Collaborer)
- le r√©sultat du round (il doit savoir s‚Äôil a gagn√© ou perdu)
- Il doit √™tre inform√© du d√©but de chaque round.

## üßê Architecture du syst√®me informatis√© <a name = "archi"></a>

Le laboratoire dispose de plusieurs ordinateurs connect√©s entre eux, chacun dans un box afin que les
volontaires ne se rencontrent pas, d‚Äôun ordinateur pour la supervision, d‚Äôun serveur et d‚Äôune
imprimante en r√©seau.

## üßê Gestion des donn√©es <a name = "data_monitoring"></a>

Le serveur central a la charge de l‚Äôensemble des donn√©es. Les donn√©es manipul√©es par le serveur
sont de nature persistante, c‚Äôest-√†-dire qu‚Äôelles doivent survivre √† l‚Äôex√©cution de l‚Äôapplication

## üßê Gestion des √©changes client/serveur <a name = "communication"></a>

Les √©changes entre les clients et le serveur doivent suivre un protocole bien d√©fini pour que le
serveur comprenne les requ√™tes des clients et pour que les clients comprennent les r√©sultats
renvoy√©s par le serveur. Les √©changes doivent √™tre consid√©r√©s au niveau applicatif et au niveau
transport.

Au niveau applicatif, vous devrez d√©finir la structure des messages qui sont √©chang√©s. Vous √™tes
invit√© √† voir la d√©finition d‚Äôun RFC. Le RFC pour le protocole HTTP est l‚Äôun des plus simple a
appr√©hender (https://tools.ietf.org/html/rfc2616).

Au niveau transport, il est impos√© d‚Äôutiliser le protocole TCP/IP. 

## üßê Consignes <a name = "consigne"></a>
## üßê Travail de base demand√© <a name = "consigne_base"></a>

Vous disposez d‚Äôun squelette de programme pour l‚Äôapplication serveur et un autre pour l‚Äôapplication
client. Apr√®s lecture des diff√©rents documents, il faudra le compl√©ter pour fournir :

Aspect r√©seau : un client et un serveur en mode TCP (le squelette de base est op√©rationnel)

Aspect syst√®me :
- un serveur parall√®le. Le code qui vous est fourni utilise des threads pour pouvoir
  g√©rer des connexions en parall√®le et faire du multit√¢che pour le traitement des requ√™tes.
- un client asynchrone capable de traiter les messages du serveur d√®s leurs r√©ceptions.
  Dans tous les cas, avant de commencer √† coder ces questions, faites une analyse des probl√®mes
  que vous voulez r√©soudre et des solutions que vous allez proposer. Si cette analyse est bien faite, le
  codage sera facile. Une bonne analyse (m√™me sans impl√©mentation) dans le rapport et la soutenance
  sera fortement valoris√©e.

  Nous vous conseillons de :
‚Äì bien respecter le cahier des charges 
- bien g√©rer le temps qui vous est imparti 
- bien discuter dans le quadrinome 
- r√©fl√©chir avant de programmer. 
- structurer votre code pour le rendre le plus √©volutif possible. 
- utiliser des assertions 
- bien formalisez le protocole (faite des simulations entre vous). 
- penser aux √©volutions possibles du projet : par exemple l‚Äô√©tat du serveur et des clients
  pourra √™tre supervis√© depuis un poste de‚Ä¶ supervision.

  Tout le code doit bien sur √™tre versionn√©. Comme toujours vous donnerez un acc√®s √† votre d√©p√¥t a
  votre enseignant.

  Vous serez tr√®s attentif aux commentaires et annotations. Il est imp√©ratif de fournir une
  documentation (Javadoc ou Doxygen).

  La pr√©sence d‚Äôassertion dans le code est un imp√©ratif, cependant les tests unitaires ne sont pas
  n√©cessaires.

## üßê Support <a name = "consigne_support"></a>

Vous serez encadr√© pendant tout le projet. Souvenez-vous cependant que votre enseignant n‚Äôest pas
un ‚Äòdegugger‚Äô. Vous pouvez le contacter par mail, mais l‚Äôenseignant n‚Äôest pas 24h/24 devant son
ordinateur : pr√©voyez donc un certain d√©lai dans les r√©ponses. Plus la question est pr√©cise
(n√©cessitant donc une r√©ponse courte), plus la r√©ponse sera rapide.

## üßê √âvaluation du travail <a name = "eval"></a>

## üßê Soutenance <a name = "eval_oral"></a>

Chaque groupe aura 20 minutes, diapositives √† l‚Äôappui, pour pr√©senter son travail. Le groupe
expliquera bri√®vement la r√©partition du travail dans le quadrin√¥me, l‚Äôavancement du projet et les
probl√®mes rencontr√©s. Il devra aussi expliquer et justifier les choix effectu√©s pour les
impl√©mentations. Le jury posera ensuite des questions et demandera √©ventuellement des
d√©monstrations. 

## üßê Rapport <a name = "eval_rapport"></a>

Le quadrinome doit rendre avant la soutenance un rapport de 4 pages (+2 pages d‚Äôannexes)
maximum donnant :
- l‚Äôorganisation du travail dans le groupe ; 
- la m√©thodologie utilis√©e dans le d√©veloppement ; 
- La justification de certains choix et l‚Äô√©valuation de la pertinence √† posteriori; 
- l‚Äô√©tat courant du projet et ce qu‚Äôil reste √† r√©aliser ; 
- les difficult√©s rencontr√©es ; 
- un rapide bilan de ce que vous a apport√© ce projet.

Le rapport ne doit pas redonner des informations pr√©sentes dans ce document. Il doit contenir
suffisamment d‚Äô√©l√©ment pour permettre au doctorant de prendre en main l‚Äôapplication. Le
README.md contiendra les √©l√©ments n√©cessaires pour utiliser les programmes, avec les formats
des fichiers de param√©trages, les formats des fichiers de donn√©es, les commandes n√©cessaires pour
compiler le code source.

Toutes les informations n√©cessaires √† la poursuite du d√©veloppement devront √™tre stock√©es dans des
fichiers de documentation (r√©pertoire doc) pr√©sent dans le projet (description du protocole par
exemple)



## üßê L'√©quipe <a name = "team"></a>

Notre √©quipe est compos√©e de 4 √©tudiants : 
 - Nicola : Originaire de BTS ...
 - Alexis : Originaire de BTS ...
 - Tarik : Originaire de BTS ...
 - Yannis : Originaire de BTS SIO Option SLAM

## üßê R√©partition du travail <a name = "work_distribution"></a>

Pour commencer, nous avons constitu√© deux groupes de travail : 
 - Tarik et Alexis : Partie client
 - Yannis et Nicola : Partie serveur

Pour la partie client, Tarik s'est occup√© de la partie GUI et Alexis de la partie de communication.

Pour la partie serveur, Nicola s'est occup√© de la partie logique du jeu, et Yannis de la communication.


## üßê M√©thodologie <a name = "methodology"></a>

Afin de s'organiser et de r√©aliser le projet, nous avons commenc√© par √©crire les diff√©rents points √† r√©aliser.

```

graphisme :

- timer visuel pour d√©but de round
- fenetre de choix avec timer, numero de round (bloquer les boutons lorsque choix est deja fait)
- afficher le resultat + timer
- afficher resultat fin de round
- fin de partie (se reconnecter)

envoi depuis le client:

- connexion config serveur (ip port)
- mise en forme des communications

reception cot√© serveur:

- setup config serveur (ip port)
- interpretation des communications

regles du jeu:

- lire la config
- gerer le nombre de joueurs
- envoyer les instructions de d√©but si nb joueurs ok
- attendre la reponse
- afficher les resultats
- stocker en fichier les resultats
- relance un round si nb round < nb round config
```

Dans un second temps, nous nous sommes organis√©s sur Github √† l'aide de diff√©rentes branches.

Une branche main vide dans le cas ou une mauvaise manipulation venait √† √™tre faite.
Une branche client pour la partie production client.
Une branche serveur pour la partie production serveur.

Une branche par personne pour la partie de d√©veloppement.

Nous avons √©galement cr√©√©e un serveur discord afin de communiquer efficacement sur le projet.

Notre approche du travail s'est bas√©e sur une m√©thodologie de d√©veloppement agile personnalis√©e.

Les heures de cours √©taient principalement utilis√©es pour la correction de bug, la discussion, le code review et la r√©daction des points √† r√©aliser et des am√©liorations √† apporter.

Pour la partie d√©veloppement, nous avons utilis√© nos heures libre.

Dans le cas ou un bug √©tait d√©tect√©, deux solutions ont √©t√© propos√©es :
- R√©solution directe par la personne ayant det√©ct√© le bug
- R√©solution par la personne ayant d√©velopp√© le code

R√©guli√®rement, nous faisions des codes reviews nous permettant de voir les changements effectu√©s par les autres membres. 


## üßê Justification des choix <a name = "justify"></a>
## üßê R√©gles de communication <a name = "communications_rules"></a>

Pour la communication, nous avons d√©fini un protocole personnalis√©.

```
Permet d'envoyer au client un identifiant pour le serveur et un identifiant local servant dans la partie client afin de d√©finir le joueur 1 et le joueur 2 
id <id_client>:<id_local>

Permet d'envoyer le num√©ro de partie au client
party <id_party>

Permet d'envoyer un status (status de la partie ou status du client)
status <status>

Permet de communiquer les r√©ponses des clients au serveur 
<answer_struct>

Permet de communiquer le recapitulatif d'un round au client
<round_struct>

Permet de communiquer l'id du winner au client
winner <int>

Permet de communiquer le recapitualtif de la partie au client
<recap_party>
```

## üßê Les difficult√©s <a name = "difficulties"></a>

Difficult√©s li√©es au code :
- Diff√©rentes mani√®res d'√©crire le code
- L'adaptation du code de chaque personne au projet
- Les diff√©rents types de bugs de m√©moire
- L'envoi de structures complexes 

Difficult√©s li√©es √† la communication :
- Les diff√©rents types de communication existant
- D√©finir un protocole personnalis√© clair et simple

Difficult√©s li√©es √† la m√©thodologie :
- Se coordonner avec les autres membres
- Se tenir √† jour avec les autres membres
- V√©rifier les changements des autres membres afin de pouvoir r√©aliser les changements

Difficult√©s li√©es √† la nouveaut√© :
- La mise en place d'un serveur
- La mise en place d'un client
- La communication avec le serveur et le client
- Mise en place d'une interface graphique

Difficult√©s li√©es √† la partie graphique :
- Choix du style de l'interface graphique
- Simplicit√© de l'interface graphique
- Brancher l'interface graphique au client

## üßê Bilan <a name = "bilan"></a>

Malgr√© les diff√©rentes difficult√©s rencontr√©es, nous avons r√©ussi √† r√©aliser le projet.
Nous en tirerons des b√©n√©fices, et nous adopterons une m√©thodologie diff√©rente en tirant profit des diff√©rentes difficult√©s rencontr√©es.

Ce projet nous aura appris √† traduire un concept en programme, en se basant sur le d√©veloppement d'un client, un serveur et un interface graphique.

Nous partions de simples connaissances basique en c et aujourd'hui nous avons √©t√© capable de mettre √† l'√©preuve nos connaissances afin de fournir un rendu final.

## üßê Build <a name = "build"></a>

Pr√©paration du build :
- Installation de la librairie GTK+3
- Installation de cmake
- Installation de make
- Installation de GCC ou un autre compilateur
- Installation de git
- Installation de Doxygen

Afin de compiler le projet nous vous proposons deux solutions :

Via un script adapt√© √† la machine que vous utilisez (Linux, MacOS)

Pour Linux et MacOS, il faut choisir le script "build_unix.sh"

Il faut ensuite ouvrir un terminal et lancer le script.
```bash
./build_<environnement>.sh
```

Dans le dossier *output*, il y aura un executable "client" et un executable "server".

Dans le dossier "client_config", vous y trouverez les fichiers de configuration du client.

Et dans le dossier "server_config", vous y trouverez les fichiers de configuration du serveur.

Via la ligne de commande.

Unix
```
cd server
mkdir build
cd build
cmake ..
make all
cp server ../server

cd ..

cd client
mkdir build
cd build
cmake ..
make all
cp client ../client
```

## üßê Configuration Serveur <a name = "config_server"></a>

Il existe deux fichiers de configurations pour le serveur :
- server_config/rules_config.json
- server_config/server_config.json

Le fichier *server_config.json* permet de configurer la partie √©coute du serveur.

````json
{
  "ip_address": "127.0.0.1",
  "port": "30000"
}
````

Il suffit de modifier les valeurs de l'ip_address avec l'ip d'√©coute et du port avec le port d'√©coute.

Le fichier *rules_config.json* permet de configurer les r√®gles du jeu.

````json
{
    "nb_round": "3",
    "default_wallet": "0",

    "trahison_win": "-5",
    "trahison_loose": "-5",

    "collab_win": "-1",
    "collab_loose": "-1",
    
    "trahison_collab_win": "0",
    "trahison_collab_loose": "-10"    
}
````

*nb_round* correspond au nombre de round que la partie aura.
```
"nb_round": "3"
```

*default_wallet* correspond √† la valeur de d√©part du porte-monnaie de chaque joueur.
```
"default_wallet": "0"
```

*trahison_win* correspond √† la valeur de gain du joueur en cas de victoire contre un trahison.
```
"trahison_win": "-5"
```

*trahison_loose* correspond √† la valeur de perte du joueur en cas de d√©faite contre un trahison.
```
"trahison_loose": "-5"
```

*collab_win* correspond √† la valeur de gain du joueur en cas de victoire contre un collab.
```
"collab_win": "-1"
```

*collab_loose* correspond √† la valeur de perte du joueur en cas de d√©faite contre un collab.
```
"collab_loose": "-1"
```

*trahison_collab_win* correspond √† la valeur de gain du joueur en cas de victoire contre un trahison et un collab.
```
"trahison_collab_win": "0"
```

*trahison_collab_loose* correspond √† la valeur de perte du joueur en cas de d√©faite contre un trahison et un collab.
```
"trahison_collab_loose": "-10"
```

## üßê Configuration Client <a name = "config_client"></a>
Pour la configuration du client il n'existe qu'un seul fichier de configuration:
- client_config/config.json

Le fichier *config.json* permet de configurer la partie connexion au serveur.

````json
{
  "ip_address": "127.0.0.1",
  "port": "30000"
}
````

Il suffit de modifier les valeurs de l'ip_address avec l'ip du serveur et du port du serveur.

## üßê Documentation <a name = "doc"></a>

Pour g√©n√©rer la documentation du projet, il suffit de lancer la commande suivante :
```bash
./build_unix_doc.sh
```

Pour acc√©der √† la documentation, il suffit de lancer le fichier *index.html* du dossier *documentation/client* ou *documentation/server* dans un navigateur web.
